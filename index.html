<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Info to JSON Converter</title>
  <style>
    body { font-family: monospace; margin: 20px; }
    textarea { width: 100%; height: 200px; }
    #output { width: 100%; height: 300px; margin-top: 10px; }
    button { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Info to JSON Converter</h2>
  <p>Paste info below and click Convert</p>
  <textarea id="input" placeholder="Paste info here..."></textarea><br>
  <button onclick="convert()">Convert</button>
  <textarea id="output" readonly placeholder="JSON output will appear here..."></textarea>

  <script>
    function convert() {
      const text = document.getElementById("input").value.trim();
      if (!text) return;

      const lines = text.split('\n').map(l => l.trim()).filter(l => l);
      const name = lines[0];

      // creator
      const creatorIndex = lines.findIndex(l => /^created by:?$/i.test(l));
      const creator = creatorIndex !== -1 && lines[creatorIndex + 1] ? lines[creatorIndex + 1] : "";

      // creation date
      const createdIndex = lines.findIndex(l => /^created:?$/i.test(l));
      const creationDate = createdIndex !== -1 && lines[createdIndex + 1] ? lines[createdIndex + 1] : "";

      const idMatch = text.match(/Level ID:\s*(\d+)/);
      const id = idMatch ? idMatch[1] : "";

      // runs
      const runsStart = lines.findIndex(l => /^\d+\s|\d+\t/.test(l));
      const runs = [];
      for (let i = runsStart; i < lines.length; i++) {
        const parts = lines[i].split(/\t+/);
        if (parts.length < 5) continue;
        const [rank, player, timeStr, arrow, finished] = parts;
        const date = finished.split(' ')[0];
        runs.push({
          name: player,
          time: parseFloat(timeStr.replace('s', '')),
          date
        });
      }

      let verifier = "";
      if (runs.length > 0) {
        verifier = runs.reduce((a, b) => (a.date < b.date ? a : b)).name;
      }

      const obj = {
        rank: 1,
        name,
        creator,
        verifier,
        thumbnail: "thumbs/" + name.replace(/\s+/g, '').toLowerCase() + ".png",
        levelLink: "https://narrowarrow.xyz/levelid=" + id,
        id,
        creationDate,
        beater: runs
      };

      // indent JSON with 4 spaces
      document.getElementById("output").value = JSON.stringify(obj, null, 4);
    }
  </script>
</body>
</html>
